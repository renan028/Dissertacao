\chapter{Resultados e Discussões}\label{result}

O capítulo~\ref{arquipro} detalhou a implementação das camadas da
arquitetura robótica híbrida de três camadas. O detalhamento da implementação
mostrou o caráter modular da arquitetura, o que torna possível o
desenvolvimento da solução em estágios independentes de programação. A
integração das camadas é trivial pelo \textit{framework} ROS e seu estilo
simples de comunicação entre os componenetes de software.

A modularidade da arquitetura permite a avaliação independente de cada camada e,
por fim, a integração é apenas um teste de comunicação entre as camadas. Os
testes da camada Funcional, no entanto, requerem o hardware, isto é, o robô
DORIS. Os testes da camada Executivo e Planejador podem ser simuladas em
ambiente de programação. Na seção~\ref{avametodologia} deste capítulo, será
desenvolvida uma metodologia para a avaliação da arquitetura híbrida de três
camadas e as seções seguintes, \ref{avafuncional}, \ref{avaexecutivo},
\ref{avaplanejador}, resumem os testes de cada camada.

\section{Metodologia para avaliação das camadas}\label{avametodologia}

Há diversos critérios de avaliação de uma arquitetura robótica. De acordo com
Arkin \cite{arkin1998behavior}, podemos avaliar arquiteturas quanto a:
\begin{itemize}
  \item \textbf{Suporte a paralelismo}.
  \item \textbf{\textit{Hardware targetability}}: este conceito se refere a
  quão bem uma arquitetura pode ser mapeada em sistemas robóticos reais, isto é,
  sensores e atuadores físicos; e o desempenho computacional.
  \item \textbf{\textit{Niche targetability}}: quão bem uma arquitetura é capaz
  de fazer o robô se adaptar ao seu ambiente de operação.
  \item \textbf{Suporte a modularidade}: desde a facilidade de encapsulamento de
  comportamentos abstratos e componentes (baixo nível) à possibilidade de
  reutilização da arquitetura para outros robôs (alto nível).
  \item \textbf{Robustez}: em caso de falha de hardwares (sensores, atuadores e
  etc), a arquitetura deve ser capaz de se recuperar. Quais os mecanismos que a
  arquitetura possui para contornar falhas?
  \item \textbf{Tempo de desenvolvimento}: quais as ferramentas e
  \textit{frameworks} disponíveis na arquitetura. 
  \item \textbf{Flexibilidade em tempo de execução}: como o sistema de controle
  pode ser ajustado ou reconfigurado em tempo de execução.
  \item \textbf{Desempenho em executar tarefas}.
\end{itemize}

A arquitetura híbrida de três camadas foi idealizada para passar com ótima
avaliação em todos os critérios de Arkin. Entretanto, como já explicitado na
subseção~\ref{3t}, há diversas formas de implementar esta arquitetura e esta
liberdade de programação acaba por não garantir boa avaliação nos critérios
estabelecidos. É importante que as camadas sejam projetadas a cumprirem os
critérios de forma satisfatória.

As camadas desenvolvidas para a DORIS foram projetadas para passar
satisfatoriamente nos critérios de Arkin e de outros roboticistas. Dessa forma,
a metodologia de avaliação e testes é verificar o desempenho nos critérios e
destacar as responsabilidades implementadas em cada camada que os cumprem os
requisitos.

\section{Testes da implementação da camada Funcional}\label{avafuncional}

A camada funcional é a primeira a ser implementada na camada da arquitetura
híbrida de três camadas. Somente com a camada funcional é possível
enviar comandos aos atuadores, ou seja, controlar o robô por \textit{joystick}
ou com uma interface simples de usuário. É possível observar os dados dos
sensores, processar os dados e testar funcionalidades básicas do robô. 

A camada Funcional desenvolvida para DORIS é detalhada na
subseção~\ref{camadafuncional} e, como já foi analisada, segue o modelo
``ideal'' de implementação de uma camada Funcional descrita por Quigley
\cite{quigley2009ros}, desenvolvedor do ROS, e Volpe \cite{volpe2001claraty},
desenvolvedor do CLARAty. Há pacotes genéricos a serem atribuidos a qualquer
robô, pacotes específicos da DORIS e pacotes com funcionalidades ROS.

Como a camada Funcional é a camada que faz interface com os hardwares
do robô (sensores e atuadores), simulações não bastam para a avaliação dos
critérios de Arkin. São necessários testes exaustivos, em campo, com o robô.

Com o auxílio das \textit{tools} (subseção~\ref{camadafuncional}, componentes
gráficos para o operador enviar comandos ao robô, o usuário pode teleoperar o
robô e observar as saídas dos sensores. A figura~\ref{teleop} mostra a
teleoperação do SAM (\textit{Single Autonomous System}), predecessor da DORIS,
em uma interface web. Na figura, pode-se observar a imagem enviada pela câmera
interna do robô e o ambiente 3D em que o robô está inserido, em RVIZ. Na
figura~\ref{robotgui}, mostram-se a interface de controle da DORIS com dados de
corrente e velocidade dos motores, a saída de vídeo da câmera interna ao robô,
e a saída de vídeo de uma câmera externa ao robô.

A camada Funcional desenvolvida no \textit{framework} ROS mostrou
\textbf{\textit{Hardware targetability}}. Além de ROS possuir um grande
repositório de drivers (interface hardware-software), os componentes específicos
desenvolvidos apresentaram ótimo desempenho. 

O \textit{framework} ROS é uma ferramenta que, usada de maneira correta, faz com
que a camada Funcional passe por quase todos os critérios de Arkin. Podemos
avaliar a camada Funcional com os critérios estabelecidos:
\begin{itemize}
  \item \textbf{Suporte a paralelismo}: é inerente a sistemas
  \textit{multi-thread} (computadores embarcados que permitem o paralelismo), e
  aos estilos de comunicação \textit{publish-subscriber} e \textit{service}, que
  permitem que os componentes obtenham, ao mesmo tempo, acesso aos diversos dados de sensores do robô.
\item \textbf{\textit{Hardware targetability}}: os diversos robôs que utilizam
ROS já mostram por si só o \textbf{\textit{Hardware targetability}} desta
ferramenta.
\item \textbf{\textit{Niche targetability}}: ROS também já foi utilizado por uma
variedade de aplicações robóticas. Além disso, os resultados em DORIS mostram
que o código implementado pode ser estendido robôs com desafios semelhantes.
\item \textbf{Suporte a modularidade}: os componentes e pacotes desenvolvidos
são modulares e seu nível de abstração permite a utilização em outros robôs. O
esquema de classes e herança é essencial para alcançar este objetivo.
\item \textbf{Robustez}: em caso de falha, a camada não entra em colapso e
mensagens de falha são enviadas a camadas superiores (Executivo e Planejador).
Mas a camada Funcional não é projetada para recuperação de falhas.
\item \textbf{Tempo de desenvolvimento}: o grande repositório disponível para o
\textit{framework} ROS reduz muito o tempo de desenvolvimento. Além disso, uma
metodologia de programação, e a separação em módulos facilita o desenvolvimento
de sistemas robóticos.
\item \textbf{Flexibilidade em tempo de execução}: os resultados de DORIS com a
teleoperação mostrou que DORIS pode ser controlado com alteração dos parâmetros
de controle em tempo real. O sistema de comunicação de ROS permite e a
implementação das \textit{tools} que se comunicam com os componentes do robô (
interação base-robô) cria esta flexiblidade em tempo de execução.
\item \textbf{Desempenho em executar tarefas}: os resultados bem
sucedidos mostraram o alto desempenho da DORIS. 
\end{itemize}
 

\begin{figure}[!ht]
\centering
\includegraphics[width=.5\columnwidth]{figs/DORIS/teleop.png}
\caption{Teleoperação da DORIS.}
\label{teleop}
\end{figure}  

\begin{figure}[!ht]
\centering
\includegraphics[width=.5\columnwidth]{figs/DORIS/robotgui2.png}
\caption{Interface de controle da DORIS.}
\label{robotgui}
\end{figure}

A camada Funcional permite, por si só, a teleoperação do robô e testes com o
sistema. Apesar de passar com excelência por quase todos os critérios
de Arkin, a camada não transforma DORIS em um sistema autônomo. As outras
camadas, além de garantirem esta nova funcionalidade, devem também cumprir os
critérios de Arkin.

\section{Testes da implementação da camada Executivo}\label{avaexecutivo}

\section{Testes da implementação da camada Planejador}\label{avaplanejador}

